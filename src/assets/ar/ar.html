<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR - Detecci√≥n M√∫ltiple</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

  <!-- LIBRERIAS LOCALES -->
  <script src="../js/aframe.min.js"></script>
  <script src="../js/aframe-ar.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
    }

    .arjs-loader {
      position: absolute;
      z-index: 999;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 1.2rem;
      font-family: Arial, sans-serif;
    }

    .loader-text {
      margin-bottom: 20px;
      font-weight: bold;
    }

    /* Status display */
    .status-display {
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #76B900;
      padding: 10px;
      border-radius: 5px;
      z-index: 1000;
      font-size: 0.9rem;
      text-align: center;
      display: none;
    }

    .detected {
      background: rgba(118, 185, 0, 0.8) !important;
      color: white !important;
      font-weight: bold;
    }

    /* Scanning frame */
    .scan-frame {
      position: absolute;
      top: 20%;
      left: 10%;
      right: 10%;
      bottom: 20%;
      pointer-events: none;
      border: 2px solid rgba(118, 185, 0, 0.5);
      border-radius: 10px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    .scan-corner {
      position: absolute;
      width: 40px;
      height: 40px;
      border: 3px solid #76B900;
    }

    .scan-corner.top-left {
      top: 0; left: 0;
      border-right: none; border-bottom: none;
    }

    .scan-corner.top-right {
      top: 0; right: 0;
      border-left: none; border-bottom: none;
    }

    .scan-corner.bottom-left {
      bottom: 0; left: 0;
      border-right: none; border-top: none;
    }

    .scan-corner.bottom-right {
      bottom: 0; right: 0;
      border-left: none; border-top: none;
    }
  </style>
</head>

<body>

<div class="arjs-loader" id="loader">
  <div class="loader-text">‚è≥ Iniciando c√°mara AR...</div>
  <div>Prepara tus marcadores</div>
</div>

<!-- Status display -->
<div class="status-display" id="status">
  Buscando marcadores...
</div>

<!-- Scanning overlay -->
<div class="scan-frame" id="scanFrame" style="display: none;">
  <div class="scan-corner top-left"></div>
  <div class="scan-corner top-right"></div>
  <div class="scan-corner bottom-left"></div>
  <div class="scan-corner bottom-right"></div>
</div>

<a-scene
  embedded
  vr-mode-ui="enabled: false"
  renderer="logarithmicDepthBuffer: true; antialias: true; colorManagement: true; sortObjects: true;"
  arjs="sourceType: webcam; 
        debugUIEnabled: false; 
        detectionMode: mono_and_matrix; 
        trackingMethod: best;
        maxDetectionRate: 90;
        canvasWidth: 640;
        canvasHeight: 480;"
>

  <!-- ========== MARCADOR 1: HIRO (PRESET) ========== -->
  <a-marker 
    preset="hiro" 
    id="marker-hiro"
    smooth="true"
    smoothCount="5"
    smoothTolerance="0.01"
    smoothThreshold="2"
  >
    <a-box
      position="0 0.5 0"
      rotation="0 45 0"
      width="1"
      height="1"
      depth="1"
      color="#4F46E5"
      animation="property: rotation; to: 0 405 0; loop: true; dur: 3000; easing: linear"
    ></a-box>
    <a-text
      value="HIRO"
      position="0 1.5 0"
      align="center"
      color="#FFFFFF"
      scale="1.5 1.5 1"
    ></a-text>
  </a-marker>

  <!-- ========== MARCADOR 2: KANJI (PRESET) ========== -->
  <a-marker 
    preset="kanji" 
    id="marker-kanji"
    smooth="true"
    smoothCount="5"
    smoothTolerance="0.01"
    smoothThreshold="2"
  >
    <a-sphere
      position="0 0.7 0"
      radius="0.7"
      color="#06B6D4"
      animation="property: scale; to: 0.8 0.8 0.8; dir: alternate; loop: true; dur: 1000"
    ></a-sphere>
    <a-text
      value="KANJI"
      position="0 1.5 0"
      align="center"
      color="#FFFFFF"
      scale="1.5 1.5 1"
    ></a-text>
  </a-marker>

  <!-- ========== MARCADOR 3: COCA-COLA (PERSONALIZADO) ========== -->
  <a-marker
    type="pattern"
    url="../markers/pattern-Coca-Cola-1210.patt"
    id="marker-cocacola"
    smooth="true"
    smoothCount="5"
    smoothTolerance="0.01"
    smoothThreshold="2"
    emitevents="true"
  >
    <!-- Cilindro rojo tipo lata -->
    <a-cylinder
      position="0 0.8 0"
      radius="0.4"
      height="1.6"
      color="#FF0000"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear"
    ></a-cylinder>
    
    <!-- Texto Coca-Cola -->
    <a-text
      value="COCA-COLA"
      position="0 1.8 0"
      align="center"
      color="#FFFFFF"
      scale="1.2 1.2 1"
      animation="property: scale; to: 1.3 1.3 1; dir: alternate; loop: true; dur: 800"
    ></a-text>

    <!-- Burbujas animadas -->
    <a-entity animation="property: rotation; to: 0 360 0; loop: true; dur: 3000; easing: linear">
      <a-sphere radius="0.1" color="#FFFFFF" position="0.5 0.5 0"></a-sphere>
      <a-sphere radius="0.08" color="#FFFFFF" position="-0.4 0.7 0"></a-sphere>
      <a-sphere radius="0.12" color="#FFFFFF" position="0.3 0.3 0"></a-sphere>
    </a-entity>
  </a-marker>

  <!-- ========== MARCADOR 4: NVIDIA RTX ========== -->
  <a-marker
    type="pattern"
    url="../markers/pattern-nvidia-geforce-rtx-logo_thmb.patt"
    id="marker-nvidia"
    smooth="true"
    smoothCount="5"
    smoothTolerance="0.01"
    smoothThreshold="2"
    emitevents="true"
  >
    <a-box
      position="0 0.5 0"
      rotation="45 45 0"
      width="1"
      height="1"
      depth="1"
      color="#76B900"
      animation="property: rotation; to: 45 405 0; loop: true; dur: 3000; easing: linear"
    ></a-box>
    <a-text
      value="NVIDIA RTX"
      position="0 1.5 0"
      align="center"
      color="#FFFFFF"
      scale="1 1 1"
    ></a-text>
  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<script>
  // Ocultar loader cuando est√© listo
  window.addEventListener('load', () => {
    setTimeout(() => {
      const loader = document.getElementById('loader');
      const scanFrame = document.getElementById('scanFrame');
      if (loader) loader.style.display = 'none';
      if (scanFrame) scanFrame.style.display = 'block';
    }, 2000);
  });

  // Event listeners para el marcador NVIDIA
  const markerNvidia = document.querySelector("#marker-nvidia");
  const scanText = document.querySelector(".scan-text");
  
  if (markerNvidia) {
    markerNvidia.addEventListener("markerFound", () => {
      console.log("‚úÖ Marcador NVIDIA RTX detectado!");
      if (scanText) {
        scanText.textContent = "¬°NVIDIA RTX detectado!";
        scanText.style.backgroundColor = "rgba(118, 185, 0, 0.8)";
      }
    });

    markerNvidia.addEventListener("markerLost", () => {
      console.log("‚ùå Marcador NVIDIA RTX perdido");
      if (scanText) {
        scanText.textContent = "Detectando marcadores...";
        scanText.style.backgroundColor = "rgba(0, 0, 0, 0.6)";
      }
    });
  }

  // Eventos para otros marcadores
  const markerHiro = document.querySelector("#marker-hiro");
  if (markerHiro) {
    markerHiro.addEventListener("markerFound", () => {
      console.log("‚úÖ Marcador HIRO detectado!");
      if (scanText) scanText.textContent = "¬°Marcador HIRO detectado!";
    });
    markerHiro.addEventListener("markerLost", () => {
      if (scanText) scanText.textContent = "Detectando marcadores...";
    });
  }

  const markerKanji = document.querySelector("#marker-kanji");
  if (markerKanji) {
    markerKanji.addEventListener("markerFound", () => {
      console.log("‚úÖ Marcador KANJI detectado!");
      if (scanText) scanText.textContent = "¬°Marcador KANJI detectado!";
    });
    markerKanji.addEventListener("markerLost", () => {
      if (scanText) scanText.textContent = "Detectando marcadores...";
    });
  }

  // ========== MARCADOR COCA-COLA ==========
  const markerCocaCola = document.querySelector("#marker-cocacola");
  if (markerCocaCola) {
    markerCocaCola.addEventListener("markerFound", () => {
      console.log("üéâü•§ ¬°MARCADOR COCA-COLA DETECTADO!");
      const statusDiv = document.getElementById('status');
      if (statusDiv) {
        statusDiv.textContent = "üéâ ¬°COCA-COLA DETECTADA!";
        statusDiv.style.background = "linear-gradient(135deg, #DC2626 0%, #B91C1C 100%)";
      }
    });
    markerCocaCola.addEventListener("markerLost", () => {
      console.log("‚ùå Marcador Coca-Cola perdido");
      const statusDiv = document.getElementById('status');
      if (statusDiv) {
        statusDiv.textContent = "Buscando marcadores...";
        statusDiv.style.background = "linear-gradient(135deg, #4F46E5 0%, #4338CA 100%)";
      }
    });
  }
</script>

</body>
</html>
